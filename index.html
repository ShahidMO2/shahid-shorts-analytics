<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>June Viewership Insights Dashboard</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.2/dist/chart.umd.min.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <!-- Chosen Palette: Warm Neutrals -->
    <!-- Application Structure Plan: The SPA now uses a tabbed navigation system at the very top to switch between major content views: "Monthly Highlights" (containing KPIs, Daily Viewership, and Overall Analysis, and Strategic Recommendations), "Top 10 Titles", and "Recommendation Titles". This approach maintains the single-page constraint while simulating "page" navigation. Each major view is a distinct HTML section that is shown or hidden via JavaScript. This enhances user flow by allowing them to jump directly to specific report areas. -->
    <!-- Visualization & Content Choices: 1. KPI Cards (Highest/Lowest/Avg Views): Goal: Inform. Method: Styled HTML/Tailwind. Interaction: Static. Justification: Provides immediate, high-level context. 2. Average Views (Overall): Goal: Compare. Method: Bar Chart. Interaction: Hover tooltips, click to highlight recommendation. Justification: Best for comparing discrete categories (days) across the entire dataset. Library: Chart.js. 3. Viewership Volatility (Overall): Goal: Show Range. Method: Floating Bar Chart. Interaction: Hover tooltips, click to highlight. Justification: Clearly visualizes data spread and volatility for each day across the entire dataset. Library: Chart.js. 4. Daily Views by Week: Goal: Track Change/Inform. Method: Bar Chart. Interaction: Weekly tabs to filter data, hover tooltips, click to highlight. Justification: Allows granular daily inspection within specific weekly contexts. Chart is initially hidden and appears on tab click. Library: Chart.js. 5. Recommendations: Goal: Advise. Method: HTML/JS Accordion. Interaction: Click to expand/collapse. Justification: Organizes detailed text, reduces cognitive load, and links interactively to charts. 6. Top 10 Titles Views Chart: Goal: Compare. Method: Bar Chart. Interaction: Hover tooltips, click to filter from table. Justification: Visually compares viewership across top titles and allows drill-down. Library: Chart.js. -->
    <!-- CONFIRMATION: NO SVG graphics used. NO Mermaid JS used. -->
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f8fafc; /* slate-50 */
        }
        .chart-container {
            position: relative;
            width: 100%;
            max-width: 800px;
            margin-left: auto;
            margin-right: auto;
            height: 400px;
        }
        @media (max-width: 768px) {
            .chart-container {
                height: 350px;
            }
        }
        @media (max-width: 640px) {
            .chart-container {
                height: 300px;
            }
        }
        .highlight {
            transition: all 0.3s ease-in-out;
            animation: pulse 1.5s ease-in-out;
        }
        @keyframes pulse {
            0% { background-color: #e0f2fe; transform: scale(1); } /* sky-100 */
            50% { background-color: #e0f2fe; transform: scale(1.01); }
            100% { background-color: transparent; transform: scale(1); }
        }
        .accordion-content {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.3s ease-in-out;
        }
        .accordion-header {
            transition: background-color 0.2s ease-in-out, box-shadow 0.2s ease-in-out;
        }
        /* Custom styling for table rows */
        #topTitlesTableBody tr:nth-child(odd) {
            background-color: #f8fafc; /* slate-50 */
        }
        #topTitlesTableBody tr:hover {
            background-color: #f1f5f9; /* slate-100 */
            transition: background-color 0.2s ease-in-out;
            cursor: pointer; /* Indicate clickable rows */
        }
        /* Styles for the dropdown menu items */
        .dropdown-menu-item {
            display: block; /* Make links take full width */
            padding: 0.5rem 1rem; /* py-2 px-4 */
            cursor: pointer;
            white-space: nowrap; /* Prevent wrapping */
            transition: background-color 0.2s ease-in-out;
            text-decoration: none; /* Remove underline from links */
            color: #1f2937; /* slate-800 equivalent for text */
        }
        .dropdown-menu-item:hover {
            background-color: #f1f5f9; /* slate-100 */
        }

        /* Styles for the Clip Performance Analysis page */
        .clip-performance-header {
            background-color: #005f73;
            color: white;
            padding: 3rem 1rem;
            text-align: center;
        }
        .clip-performance-header h1 {
            font-size: 2.25rem; /* text-4xl */
            font-weight: 700; /* font-bold */
        }
        .clip-performance-header p {
            margin-top: 1rem;
            font-size: 1.125rem; /* text-lg */
            color: #e2e8f0; /* gray-200 */
        }
        @media (min-width: 768px) {
            .clip-performance-header h1 {
                font-size: 3rem; /* md:text-5xl */
            }
            .clip-performance-header p {
                font-size: 1.25rem; /* md:text-xl */
            }
        }
        .clip-performance-section-title {
            font-size: 1.875rem; /* text-3xl */
            font-weight: 700; /* font-bold */
            text-align: center;
            color: #005f73;
            margin-bottom: 2rem;
        }
        .kpi-card {
            background-color: white;
            padding: 1.5rem;
            border-radius: 0.5rem;
            box-shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1);
            text-align: center;
        }
        .kpi-card p:first-child {
            font-size: 3rem; /* text-5xl */
            font-weight: 800; /* font-extrabold */
        }
        .kpi-card p:last-child {
            margin-top: 0.5rem;
            font-size: 1.125rem; /* text-lg */
            font-weight: 500; /* font-medium */
            color: #4b5563; /* gray-600 */
        }
        .kpi-card.total-profiles p:first-child { color: #0a9396; }
        .kpi-card.total-clips p:first-child { color: #ee9b00; }
        .kpi-card.total-views p:first-child { color: #ae2012; }

        .recommendation-card {
            background-color: white;
            padding: 1.5rem;
            border-radius: 0.5rem;
            box-shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1);
            border-left-width: 4px;
        }
        .recommendation-card h3 {
            font-weight: 700; /* font-bold */
            font-size: 1.125rem; /* text-lg */
            margin-bottom: 0.5rem;
            color: #005f73;
        }
        .recommendation-card p {
            color: #4b5563; /* gray-600 */
        }
        .recommendation-card.blue-border { border-left-color: #0a9396; }
        .recommendation-card.yellow-border { border-left-color: #ee9b00; }
        .recommendation-card.red-border { border-left-color: #ae2012; }

        .clip-performance-footer {
            text-align: center;
            padding: 1.5rem;
            margin-top: 3rem;
            background-color: #005f73;
            color: #d1d5db; /* gray-300 */
        }
        .clip-performance-footer p {
            margin-bottom: 0.5rem;
        }
        .clip-performance-footer a {
            margin-top: 1rem;
            display: inline-block;
            padding: 0.5rem 1.5rem;
            background-color: #0ea5e9; /* sky-600 */
            color: white;
            border-radius: 0.375rem; /* rounded-md */
            box-shadow: 0 1px 2px 0 rgb(0 0 0 / 0.05); /* shadow-sm */
            transition: background-color 0.2s ease-in-out;
        }
        .clip-performance-footer a:hover {
            background-color: #0284c7; /* sky-700 */
        }

        /* Modal specific styles */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.7);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.3s ease-in-out, visibility 0.3s ease-in-out;
        }

        .modal-overlay.show {
            opacity: 1;
            visibility: visible;
        }

        .modal-content {
            background-color: white;
            padding: 1.5rem;
            border-radius: 0.75rem;
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
            width: 90%;
            max-width: 600px;
            transform: translateY(-20px);
            opacity: 0;
            transition: transform 0.3s ease-in-out, opacity 0.3s ease-in-out;
            position: relative; /* For close button positioning */
        }

        .modal-overlay.show .modal-content {
            transform: translateY(0);
            opacity: 1;
        }

        .modal-close-btn {
            position: absolute;
            top: 1rem;
            right: 1rem;
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: #4b5563; /* gray-600 */
            transition: color 0.2s ease-in-out;
        }

        .modal-close-btn:hover {
            color: #1f2937; /* gray-900 */
        }

        .modal-table-container {
            max-height: 400px; /* Limit height for scrollability */
            overflow-y: auto;
            margin-top: 1rem;
            border: 1px solid #e2e8f0; /* slate-200 */
            border-radius: 0.5rem;
        }

        .modal-table {
            width: 100%;
            border-collapse: collapse;
        }

        .modal-table th, .modal-table td {
            padding: 0.75rem 1rem;
            text-align: left;
            border-bottom: 1px solid #e2e8f0; /* slate-200 */
        }

        .modal-table thead {
            background-color: #f1f5f9; /* slate-100 */
            position: sticky;
            top: 0;
            z-index: 10; /* Ensure header stays on top when scrolling */
        }

        .modal-table th {
            font-size: 0.75rem; /* text-xs */
            font-weight: 600; /* font-semibold */
            text-transform: uppercase;
            color: #475569; /* slate-600 */
        }

        .modal-table tbody tr:nth-child(odd) {
            background-color: #f8fafc; /* slate-50 */
        }

        .modal-table tbody tr:hover {
            background-color: #e2e8f0; /* slate-200 */
        }

        /* Temporary message style */
        #debugMessage {
            position: fixed;
            top: 1rem;
            right: 1rem;
            background-color: #fefcbf; /* yellow-100 */
            color: #854d0c; /* yellow-800 */
            padding: 0.75rem 1.25rem;
            border-radius: 0.5rem;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            z-index: 1001;
            opacity: 0;
            transition: opacity 0.3s ease-in-out;
            pointer-events: none; /* Allow clicks to pass through */
        }
        #debugMessage.show {
            opacity: 1;
        }
    </style>
</head>
<body class="text-slate-800">

    <div class="container mx-auto p-4 md:p-8 max-w-7xl">

        <!-- New Top-Level Report Navigation -->
        <nav class="mb-8 md:mb-12">
            <div class="inline-flex bg-slate-100 p-1 rounded-lg text-sm flex-wrap justify-center gap-2 w-full">
                <button id="juneReportBtn" class="px-4 py-2 rounded-md bg-sky-600 text-white shadow-sm font-semibold report-nav-btn" data-target="june-report-content">June Performance Analysis</button>
                <button id="julyReportBtn" class="px-4 py-2 rounded-md bg-slate-200 text-slate-800 font-medium report-nav-btn hover:bg-slate-300" data-target="july-report-content">July Performance Analysis</button>
                
                <!-- DMCS Views with Hover Dropdown -->
                <div class="relative group">
                    <button id="dmcsViewsBtn" class="px-4 py-2 rounded-md bg-slate-200 text-slate-800 font-medium report-nav-btn hover:bg-slate-300" data-target="dmcs-views-content">DMCS Views</button>
                    <div class="absolute hidden group-hover:block bg-white shadow-lg rounded-md mt-1 z-10 min-w-[120px] overflow-hidden">
                        <a href="#" class="dropdown-menu-item" data-target-section="dmcs-june-content">June</a>
                        <a href="#" class="dropdown-menu-item" data-target-section="dmcs-july-content">July</a>
                    </div>
                </div>

                <!-- Third Party Views button now navigates to an overview page section -->
                <button id="thirdPartyViewsBtn" class="px-4 py-2 rounded-md bg-slate-200 text-slate-800 font-medium report-nav-btn hover:bg-slate-300" data-target="third-party-overview-section">Third Party Views</button>

                <button id="additionalInsightsBtn" class="px-4 py-2 rounded-md bg-slate-200 text-slate-800 font-medium report-nav-btn hover:bg-slate-300" data-target="additional-insights-content">Additional Insights</button>
            </div>
        </nav>

        <!-- Main Content Area - Each section corresponds to a top-level nav button -->
        <div id="june-report-content" class="report-content-section">
            <header class="text-center mb-8 md:mb-12">
                <h1 class="text-3xl md:text-4xl font-bold text-slate-900">June Viewership Performance Analysis</h1>
                <p class="mt-2 text-lg text-slate-600">Uncovering Key Trends & Strategic Opportunities</p>
            </header>

            <!-- Top-level Navigation Tabs (Dashboard, Top 10 Titles, Recommendation Titles) -->
            <nav class="mb-8 md:mb-12">
                <div class="inline-flex bg-slate-100 p-1 rounded-lg text-sm flex-wrap justify-center gap-2 w-full">
                    <button id="dashboardTabBtn" class="px-4 py-2 rounded-md bg-white text-sky-600 shadow-sm font-semibold main-tab-btn" data-target="dashboard-section">Monthly Highlights</button>
                    <button id="topTitlesTabBtn" class="px-4 py-2 rounded-md text-slate-600 font-medium main-tab-btn" data-target="top-titles-section">Top 10 Titles Views</button>
                    <button id="recommendationTitlesTabBtn" class="px-4 py-2 rounded-md text-slate-600 font-medium main-tab-btn" data-target="recommendation-titles-section">Recommendation Titles</button>
                </div>
            </nav>

            <main>
                <!-- Dashboard Section (Default View) -->
                <section id="dashboard-section" class="main-content-section">
                    <!-- Key Metrics Section -->
                    <section id="kpis" class="mb-8 md:mb-12">
                        <h2 class="text-2xl font-semibold text-slate-900 mb-4 text-center">Monthly Highlights</h2>
                        <div class="grid grid-cols-2 md:grid-cols-4 gap-4 md:gap-6 text-center">
                            <div class="bg-white p-4 rounded-xl shadow-sm border border-slate-200">
                                <p class="text-sm font-medium text-slate-500">Highest Viewership</p>
                                <p id="kpiHighest" class="text-3xl font-bold text-sky-600 mt-1">859K</p>
                                <p id="kpiHighestDay" class="text-xs text-slate-400">on a Friday</p>
                            </div>
                            <div class="bg-white p-4 rounded-xl shadow-sm border border-slate-200">
                                <p class="text-sm font-medium text-slate-500">Lowest Viewership</p>
                                <p id="kpiLowest" class="text-3xl font-bold text-amber-600 mt-1">433K</p>
                                <p id="kpiLowestDay" class="text-xs text-slate-400">on a Sunday</p>
                            </div>
                            <div class="bg-white p-4 rounded-xl shadow-sm border border-slate-200">
                                <p class="text-sm font-medium text-slate-500">Avg. Mid-Week Views</p>
                                <p id="kpiMidWeekAvg" class="text-3xl font-bold text-slate-700 mt-1">771K</p>
                                <p class="text-xs text-slate-400">(Tue-Thu)</p>
                            </div>
                            <div class="bg-white p-4 rounded-xl shadow-sm border border-slate-200">
                                <p class="text-sm font-medium text-slate-500">Avg. Weekend Views</p>
                                <p id="kpiWeekendAvg" class="text-3xl font-bold text-slate-700 mt-1">663K</p>
                                <p class="text-xs text-slate-400">(Sat-Sun)</p>
                            </div>
                        </div>
                    </section>

                    <!-- Daily Viewership by Week Section -->
                    <section id="weeklyDailyViewsSection" class="bg-white p-4 sm:p-6 rounded-xl shadow-sm border border-slate-200 mb-8 md:mb-12">
                        <div class="text-center mb-6">
                            <h2 class="text-2xl font-semibold text-slate-900">Daily Viewership by Week</h2>
                            <p class="text-slate-600 mt-1">Click a week to see daily view trends for that period.</p>
                            <div class="mt-4 inline-flex bg-slate-100 p-1 rounded-lg text-sm flex-wrap justify-center gap-2">
                                <button id="week1DailyBtn" class="px-4 py-1.5 rounded-md text-slate-600 font-medium weekly-daily-btn">Week 1</button>
                                <button id="week2DailyBtn" class="px-4 py-1.5 rounded-md text-slate-600 font-medium weekly-daily-btn">Week 2</button>
                                <button id="week3DailyBtn" class="px-4 py-1.5 rounded-md text-slate-600 font-medium weekly-daily-btn">Week 3</button>
                                <button id="week4DailyBtn" class="px-4 py-1.5 rounded-md text-slate-600 font-medium weekly-daily-btn">Week 4</button>
                            </div>
                        </div>
                        <div id="dailyChartContainer" class="chart-container hidden">
                            <canvas id="dailyViewsChart"></canvas>
                        </div>
                    </section>

                    <!-- Overall Interactive Chart Section -->
                    <section id="charts" class="bg-white p-4 sm:p-6 rounded-xl shadow-sm border border-slate-200 mb-8 md:mb-12">
                        <div class="text-center mb-6">
                            <h2 class="text-2xl font-semibold text-slate-900">Overall Weekly Performance Analysis</h2>
                            <p class="text-slate-600 mt-1">Compare average performance and volatility across the entire month.</p>
                            <div class="mt-4 inline-flex bg-slate-100 p-1 rounded-lg text-sm">
                                <button id="avgBtn" class="px-4 py-1.5 rounded-md bg-white text-sky-600 shadow-sm font-semibold chart-type-btn">Average Performance</button>
                                <button id="rangeBtn" class="px-4 py-1.5 rounded-md text-slate-600 font-medium chart-type-btn">Volatility Analysis</button>
                            </div>
                        </div>

                        <div id="avgChartContainer" class="chart-container">
                            <canvas id="averageViewsChart"></canvas>
                        </div>
                        <div id="rangeChartContainer" class="chart-container hidden">
                            <canvas id="rangeViewsChart"></canvas>
                        </div>
                    </section>

                    <!-- Strategic Recommendations Section (Now part of Monthly Highlights) -->
                    <section id="recommendations">
                        <h2 class="text-2xl font-semibold text-slate-900 mb-4 text-center">Strategic Recommendations</h2>
                        <div class="space-y-3 max-w-4xl mx-auto">
                            <div class="accordion-item bg-white rounded-xl shadow-sm border border-slate-200" data-day="Thursday,Tuesday,Wednesday">
                                <button class="accordion-header w-full flex justify-between items-center text-left p-4 font-semibold text-slate-800 hover:bg-slate-50 hover:shadow-md">
                                    Leverage Mid-Week Dominance
                                    <span class="transform transition-transform duration-300">
                                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m6 9 6 6 6-6"/></svg>
                                    </span>
                                </button>
                                <div class="accordion-content">
                                    <div class="p-4 pt-0 text-slate-600">
                                        <ul class="list-disc pl-5 space-y-1">
                                            <li>Prioritize high-impact content and major announcements on these days.</li>
                                            <li>Schedule primary marketing pushes to align with peak mid-week engagement.</li>
                                            <li>Maximize reach and viewership by focusing efforts where the audience is most active.</li>
                                        </ul>
                                    </div>
                                </div>
                            </div>
                            <div class="accordion-item bg-white rounded-xl shadow-sm border border-slate-200" data-day="Saturday,Sunday">
                                <button class="accordion-header w-full flex justify-between items-center text-left p-4 font-semibold text-slate-800 hover:bg-slate-50 hover:shadow-md">
                                    Optimize Weekend Strategy
                                    <span class="transform transition-transform duration-300">
                                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m6 9 6 6 6-6"/></svg>
                                    </span>
                                </button>
                                <div class="accordion-content">
                                     <div class="p-4 pt-0 text-slate-600">
                                        <ul class="list-disc pl-5 space-y-1">
                                            <li>Experiment with different content formats or themes, suchs as "evergreen" or "lean-back" content.</li>
                                            <li>Align content with typical weekend audience behavior (e.g., relaxation, entertainment).</li>
                                            <li>Consider A/B testing post times to find optimal engagement windows on weekends.</li>
                                        </ul>
                                    </div>
                                </div>
                            </div>
                            <div class="accordion-item bg-white rounded-xl shadow-sm border border-slate-200" data-day="Friday">
                                <button class="accordion-header w-full flex justify-between items-center text-left p-4 font-semibold text-slate-800 hover:bg-slate-50 hover:shadow-md">
                                    Decipher Friday's Volatility
                                     <span class="transform transition-transform duration-300">
                                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m6 9 6 6 6-6"/></svg>
                                    </span>
                                </button>
                                 <div class="accordion-content">
                                    <div class="p-4 pt-0 text-slate-600">
                                        <ul class="list-disc pl-5 space-y-1">
                                            <li>Conduct a deep dive into factors that drove the $859K$ peak on a Friday.</li>
                                            <li>Identify specific content, promotional strategies, or external events contributing to success.</li>
                                            <li>Develop strategies to replicate high performance and mitigate low-performing Fridays.</li>
                                        </ul>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </section>
                </main>
            </div>

            <!-- Top 10 Titles Section (Initially Hidden) -->
            <section id="top-titles-section" class="report-content-section hidden">
                <div class="bg-white p-4 sm:p-6 rounded-xl shadow-sm border border-slate-200 mb-8 md:mb-12">
                    <h2 class="text-2xl font-semibold text-slate-900 mb-4 text-center">Top 10 Titles Views (June)</h2>
                    <p class="text-slate-600 mb-6 text-center">Here are the top 10 performing titles based on viewership data for June:</p>
                    <div class="overflow-x-auto mb-8"> <!-- Added mb-8 for space -->
                        <table class="min-w-full rounded-lg overflow-hidden shadow-sm border border-slate-200">
                            <thead class="bg-slate-100 border-b border-slate-200">
                                <tr>
                                    <th class="px-4 py-3 text-left text-xs font-semibold text-slate-700 uppercase tracking-wider">Rank</th>
                                    <th class="px-4 py-3 text-left text-xs font-semibold text-slate-700 uppercase tracking-wider">Title Name</th>
                                    <th class="px-4 py-3 text-left text-xs font-semibold text-slate-700 uppercase tracking-wider">Total Views</th>
                                    <th class="px-4 py-3 text-left text-xs font-semibold text-slate-700 uppercase tracking-wider">Total Likes</th>
                                    <th class="px-4 py-3 text-left text-xs font-semibold text-slate-700 uppercase tracking-wider">Avg. Views Per Clip</th>
                                    </tr>
                            </thead>
                            <tbody id="topTitlesTableBody" class="divide-y divide-slate-200 text-sm text-slate-700">
                                <!-- Data will be inserted here by JavaScript -->
                            </tbody>
                        </table>
                    </div>
                    <div class="chart-container">
                        <canvas id="topTitlesViewsChart"></canvas>
                    </div>
                    <div class="text-center mt-4">
                        <button id="showAllTitlesBtn" class="px-4 py-2 rounded-md bg-sky-600 text-white shadow-sm font-semibold hover:bg-sky-700 transition-colors duration-200">Show All Titles</button>
                    </div>
                </div>
            </section>

            <!-- Recommendation Titles Section (Initially Hidden) -->
            <section id="recommendation-titles-section" class="report-content-section hidden">
                <div class="bg-white p-4 sm:p-6 rounded-xl shadow-sm border border-slate-200 mb-8 md:mb-12">
                    <h2 class="text-2xl font-semibold text-slate-900 mb-4 text-center">Recommendation Titles for July</h2>
                    <p class="text-slate-600 mb-6 text-center">Based on June's viewership trends and average performance, here are some recommended title categories or themes to focus on for July to potentially maximize engagement.</p>
                    <ul class="list-disc pl-8 space-y-3 text-slate-700">
                        <li>**Mid-Week Boosters:** Content designed for high engagement on Tuesdays, Wednesdays, and Thursdays.
                            <ul class="list-circle pl-5 text-slate-600">
                                <li>*Example:* "Deep Dive: Advanced Analytics Strategies" (for a Tuesday release)</li>
                                <li>*Example:* "Webinar Series: Mastering Digital Marketing" (for a Wednesday slot)</li>
                            </ul>
                        </li>
                        <li>**Weekend Engagement:** Lighter, more evergreen, or community-focused content for Saturdays and Sundays.
                            <ul class="list-circle pl-5 text-slate-600">
                                <li>*Example:* "Behind the Scenes: Our Creative Process" (Sunday feature)</li>
                                <li>*Example:* "Community Spotlight: User Success Stories" (Saturday share)</li>
                            </ul>
                        </li>
                        <li>**Friday Potential:** High-impact, potentially viral content to capture the variable but high-peak Friday audience.
                            <ul class="list-circle pl-5 text-slate-600">
                                <li>*Example:* "Exclusive Interview: Industry Leader Insights" (Friday morning drop)</li>
                                <li>*Example:* "Flash Sale Announcement: Limited Time Offer" (if applicable)</li>
                            </ul>
                        </li>
                        <li>**Trending Topics:** Titles that capitalize on current events or popular searches (requires ongoing research).
                            <ul class="list-circle pl-5 text-slate-600">
                                <li>*Example:* "Impact of AI on [Specific Industry]"</li>
                                <li>*Example:* "Decoding the Latest [Tech/Market] Trends"</li>
                            </ul>
                        </li>
                    </ul>
                </div>
            </section>

            <!-- Placeholder sections for other top-level reports -->
            <section id="july-report-content" class="report-content-section hidden">
                <div class="bg-white p-4 sm:p-6 rounded-xl shadow-sm border border-slate-200 mb-8 md:mb-12 text-center">
                    <h2 class="text-2xl font-semibold text-slate-900 mb-4">July Performance Analysis</h2>
                    <p class="text-slate-600 text-lg font-medium">Coming Soon!</p>
                </div>
            </section>
            <section id="dmcs-views-content" class="report-content-section hidden">
                <div class="bg-white p-4 sm:p-6 rounded-xl shadow-sm border border-slate-200 mb-8 md:mb-12 text-center">
                    <h2 class="text-2xl font-semibold text-slate-900 mb-4">DMCS Views</h2>
                    <p class="text-slate-600">Content specific to DMCS views will go here, updated based on month selection.</p>
                </div>
            </section>
            
            <!-- Third Party Views Overview Section (New) -->
            <section id="third-party-overview-section" class="report-content-section hidden">
                <div class="bg-white p-8 rounded-xl shadow-lg border border-slate-200 text-center max-w-2xl mx-auto w-full">
                    <h1 class="text-3xl font-bold text-slate-900 mb-4">Third Party Views Overview</h1>
                    <p class="text-lg text-slate-600 mb-6">Select a month to view detailed third-party viewership data.</p>
                    
                    <div class="flex flex-col sm:flex-row justify-center gap-4 mb-8">
                        <button class="inline-block px-8 py-3 bg-sky-600 text-white rounded-md shadow-md hover:bg-sky-700 transition-colors duration-200 text-lg font-semibold third-party-month-btn" data-target-section="third-party-july-content">View July Data</button>
                        <button class="inline-block px-8 py-3 bg-sky-600 text-white rounded-md shadow-md hover:bg-sky-700 transition-colors duration-200 text-lg font-semibold third-party-month-btn" data-target-section="third-party-june-content">View June Data</button>
                    </div>

                    <button class="mt-6 inline-block px-6 py-2 bg-slate-200 text-slate-800 rounded-md shadow-sm hover:bg-slate-300 transition-colors duration-200 back-to-main-dashboard">Back to Dashboard</button>
                </div>
            </section>

            <!-- Third Party Views - June Content (Integrated) -->
            <section id="third-party-june-content" class="report-content-section hidden">
                <div class="bg-white p-4 sm:p-6 rounded-xl shadow-sm border border-slate-200 mb-8 md:mb-12 text-center">
                    <h2 class="text-2xl font-semibold text-slate-900 mb-4">Third Party Views - June</h2>
                    <p class="text-slate-600">This page will display detailed Third Party viewership data for June.</p>
                    <p class="mt-4 text-xl font-semibold text-sky-600">Coming Soon!</p>
                    <button class="mt-6 inline-block px-6 py-2 bg-sky-600 text-white rounded-md shadow-sm hover:bg-sky-700 transition-colors duration-200 back-to-main-dashboard">Back to Dashboard</button>
                </div>
            </section>

            <!-- Third Party Views - July Content (Integrated) -->
            <section id="third-party-july-content" class="report-content-section hidden">
                <header class="clip-performance-header">
                    <div class="max-w-4xl mx-auto">
                        <h1 class="text-4xl md:text-5xl font-bold">Unlocking Content Performance</h1>
                        <p class="mt-4 text-lg md:text-xl text-gray-200">A Deep Dive into Clip Views and Engagement Based on Channel Data</p>
                    </div>
                </header>

                <main class="max-w-7xl mx-auto p-4 sm:p-6 md:p-8">

                    <section id="overview" class="mb-12">
                        <h2 class="clip-performance-section-title">Performance at a Glance</h2>
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-6 text-center">
                            <div class="kpi-card total-profiles">
                                <p id="total-profiles">40</p>
                                <p>Profiles Analyzed</p>
                            </div>
                            <div class="kpi-card total-clips">
                                <p id="total-clips">544</p>
                                <p>Total Clips</p>
                            </div>
                            <div class="kpi-card total-views">
                                <p id="total-views">1.38M+</p>
                                <p>Total Clip Views</p>
                            </div>
                        </div>
                    </section>

                    <section id="top-performers" class="space-y-12">
                        <div class="grid grid-cols-1 lg:grid-cols-2 gap-8 items-start">
                            <div class="chart-container">
                                <canvas id="totalViewsChart"></canvas>
                            </div>
                            <div class="mt-8 lg:mt-0">
                                <h3 class="text-2xl font-bold text-[#005f73] mb-4">Champions of Reach: Top 10 by Total Views</h3>
                                <p class="text-gray-600 leading-relaxed">
                                    This chart highlights the profiles that have garnered the highest number of total views across all their clips. These are the powerhouses of audience reach, demonstrating a remarkable ability to attract a large volume of viewers. Topping the list, 'Al Atawla S1' and 'Al Ameel (Icerde) S1' show exceptional performance, indicating a strong and broad audience appeal.
                                </p>
                            </div>
                        </div>

                        <!-- New button for "More Details" -->
                        <div class="text-center mt-4">
                            <button id="showTopTotalViewsTableBtn" class="px-4 py-2 rounded-md bg-sky-600 text-white shadow-sm font-semibold hover:bg-sky-700 transition-colors duration-200">More Details</button>
                        </div>

                        <!-- New table for Top 10 Profiles by Total Views (initially hidden) -->
                        <div id="topTotalViewsTableContainer" class="overflow-x-auto mt-8 hidden">
                            <table class="min-w-full rounded-lg overflow-hidden shadow-sm border border-slate-200">
                                <thead class="bg-slate-100 border-b border-slate-200">
                                    <tr>
                                        <th class="px-4 py-3 text-left text-xs font-semibold text-slate-700 uppercase tracking-wider">Profile Name</th>
                                        <th class="px-4 py-3 text-left text-xs font-semibold text-slate-700 uppercase tracking-wider">Number of Clips</th>
                                        <th class="px-4 py-3 text-left text-xs font-semibold text-slate-700 uppercase tracking-wider">Total Views</th>
                                        <th class="px-4 py-3 text-left text-xs font-semibold text-slate-700 uppercase tracking-wider">Avg. Views Per Clip</th>
                                    </tr>
                                </thead>
                                <tbody id="topTotalViewsTableBody" class="divide-y divide-slate-200 text-sm text-slate-700">
                                    <!-- Data will be inserted here by JavaScript -->
                                </tbody>
                            </table>
                        </div>

                        <div class="grid grid-cols-1 lg:grid-cols-2 gap-8 items-start">
                            <div class="mt-8 lg:mt-0 lg:order-2">
                                <h3 class="text-2xl font-bold text-[#005f73] mb-4">Masters of Efficiency: Top 10 by Average Views</h3>
                                <p class="text-gray-600 leading-relaxed">
                                    While total views are important, average views per clip reveal content efficiency and consistent quality. This chart showcases the profiles whose individual clips are the most engaging. 'Al Ameel (Icerde) S1' leads significantly, proving that each piece of their content packs a powerful punch. This metric is key to identifying which content strategies are most effective at capturing and holding audience attention on a per-clip basis.
                                </p>
                            </div>
                            <div class="chart-container lg:order-1">
                                <canvas id="avgViewsChart"></canvas>
                            </div>
                        </div>
                    </section>

                    <section id="low-performing-titles-section" class="mt-16">
                        <h2 class="clip-performance-section-title">Low 5 Titles Performance Analysis (by Average Views)</h2>
                        <div class="bg-white p-4 sm:p-6 rounded-xl shadow-sm border border-slate-200 mb-8 md:mb-12">
                            <div class="chart-container">
                                <canvas id="lowAvgViewsChart"></canvas>
                            </div>
                            <!-- New button for "More Details" for low performing titles -->
                            <div class="text-center mt-4">
                                <button id="showLowAvgViewsTableBtn" class="px-4 py-2 rounded-md bg-sky-600 text-white shadow-sm font-semibold hover:bg-sky-700 transition-colors duration-200">More Details</button>
                            </div>
                            <div id="lowTitlesTableContainer" class="overflow-x-auto mt-8 hidden">
                                <table class="min-w-full rounded-lg overflow-hidden shadow-sm border border-slate-200">
                                    <thead class="bg-slate-100 border-b border-slate-200">
                                        <tr>
                                            <th class="px-4 py-3 text-left text-xs font-semibold text-slate-700 uppercase tracking-wider">Profile Name</th>
                                            <th class="px-4 py-3 text-left text-xs font-semibold text-slate-700 uppercase tracking-wider">Number of Clips</th>
                                            <th class="px-4 py-3 text-left text-xs font-semibold text-slate-700 uppercase tracking-wider">Total Views</th>
                                            <th class="px-4 py-3 text-left text-xs font-semibold text-slate-700 uppercase tracking-wider">Avg. Views Per Clip</th>
                                            <th class="px-4 py-3 text-left text-xs font-semibold text-slate-700 uppercase tracking-wider">Why Stop Working on This Title?</th>
                                        </tr>
                                    </thead>
                                    <tbody id="lowTitlesTableBody" class="divide-y divide-slate-200 text-sm text-slate-700">
                                        <!-- Data will be inserted here by JavaScript -->
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </section>

                    <section id="recommendations" class="mt-16">
                        <h2 class="clip-performance-section-title">Key Insights & Strategic Recommendations</h2>
                        <div id="dynamic-recommendations" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                            <!-- Default, static recommendations to appear directly -->
                            <div class="recommendation-card blue-border">
                                <h3 class="font-bold text-lg mb-2 text-[#005f73]">Emulate High-Efficiency Profiles</h3>
                                <ul class="list-disc pl-5 text-gray-600 space-y-1">
                                    <li>Analyze content strategies of profiles with high average views per clip (e.g., 'Al Ameel (Icerde) S1').</li>
                                    <li>Identify common themes, lengths, or engagement tactics that contribute to their per-clip effectiveness.</li>
                                    <li>Apply these insights to new content creation to maximize engagement even with fewer clips.</li>
                                </ul>
                            </div>
                            <div class="recommendation-card yellow-border">
                                <h3 class="font-bold text-lg mb-2 text-[#005f73]">Optimize High-Reach Channels</h3>
                                <ul class="list-disc pl-5 text-gray-600 space-y-1">
                                    <li>Invest further in content production and promotion for profiles with high total views (e.g., 'Al Atawla S1').</li>
                                    <li>Explore cross-promotion opportunities between high-reach and high-efficiency content.</li>
                                    <li>Leverage these popular channels to introduce new content or drive specific audience actions.</li>
                                </ul>
                            </div>
                            <div class="recommendation-card red-border">
                                <h3 class="font-bold text-lg mb-2 text-[#005f73]">Prioritize Quality Over Quantity</h3>
                                <ul class="list-disc pl-5 text-gray-600 space-y-1">
                                    <li>Focus on creating compelling, high-quality clips rather than simply increasing clip count.</li>
                                    <li>The scatter plots indicate that more clips do not necessarily translate to higher average engagement.</li>
                                    <li>Allocate resources to enhance the production value and narrative strength of each clip.</li>
                                </ul>
                            </div>
                        </div>
                    </section>

                </main>

                <footer class="clip-performance-footer">
                    <p>Infographic Generated on July 14, 2025.</p>
                    <p class="text-sm">Data Source: 1_14Jul.xlsx - Sheet3.csv</p>
                    <button class="mt-4 inline-block px-6 py-2 bg-sky-600 text-white rounded-md shadow-sm hover:bg-sky-700 transition-colors duration-200 back-to-main-dashboard">Back to Dashboard</button>
                </footer>
            </section>

        </div> <!-- End of june-report-content container -->

        <footer class="text-center mt-12 text-slate-500 text-sm">
            <p>Report Generated: July 8, 2025</p>
        </footer>
    </div>

    <!-- Modal Structure -->
    <div id="shortsModal" class="modal-overlay">
        <div class="modal-content">
            <button class="modal-close-btn" id="closeModalBtn">&times;</button>
            <h3 class="text-xl font-bold text-slate-800 mb-4" id="modalTitle">Leyla Shorts Views</h3>
            <div class="modal-table-container">
                <table class="modal-table">
                    <thead>
                        <tr>
                            <th>Short Title</th>
                            <th>Views</th>
                        </tr>
                    </thead>
                    <tbody id="modalTableBody">
                        <!-- Shorts data will be inserted here -->
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <!-- Debug Message Element -->
    <div id="debugMessage" class="hidden"></div>

    <script>
        document.addEventListener('DOMContentLoaded', function () {
            const fullDailyData = [
                { date: 'Jun 1', day: 'Sunday', views: 433 },
                { date: 'Jun 2', day: 'Monday', views: 596 },
                { date: 'Jun 3', day: 'Tuesday', views: 641 },
                { date: 'Jun 4', day: 'Wednesday', views: 655 },
                { date: 'Jun 5', day: 'Thursday', views: 825 },
                { date: 'Jun 6', day: 'Friday', views: 553 },
                { date: 'Jun 7', day: 'Saturday', views: 542 },
                // Week 2
                { date: 'Jun 8', day: 'Sunday', views: 639 },
                { date: 'Jun 9', day: 'Monday', views: 725 },
                { date: 'Jun 10', day: 'Tuesday', views: 823 },
                { date: 'Jun 11', day: 'Wednesday', views: 811 },
                { date: 'Jun 12', day: 'Thursday', views: 752 },
                { date: 'Jun 13', day: 'Friday', views: 738 },
                { date: 'Jun 14', day: 'Saturday', views: 685 },
                // Week 3
                { date: 'Jun 15', day: 'Sunday', views: 788 },
                { date: 'Jun 16', day: 'Monday', views: 825 },
                { date: 'Jun 17', day: 'Tuesday', views: 795 },
                { date: 'Jun 18', day: 'Wednesday', views: 752 },
                { date: 'Jun 19', day: 'Thursday', views: 731 },
                { date: 'Jun 20', day: 'Friday', views: 726 },
                { date: 'Jun 21', day: 'Saturday', views: 759 },
                // Week 4
                { date: 'Jun 22', day: 'Sunday', views: 743 },
                { date: 'Jun 23', day: 'Monday', views: 752 },
                { date: 'Jun 24', day: 'Tuesday', views: 794 },
                { date: 'Jun 25', day: 'Wednesday', views: 839 },
                { date: 'Jun 26', day: 'Thursday', views: 834 },
                { date: 'Jun 27', day: 'Friday', views: 859 },
                { date: 'Jun 28', day: 'Saturday', views: 681 },
                // Week 5 (partial, not explicitly a 'Week 5' tab, but included in 'All Weeks')
                { date: 'Jun 29', day: 'Sunday', views: 692 },
                { date: 'Jun 30', day: 'Monday', views: 717 }
            ];

            const top10TitlesData = [
                { rank: 1, title: "AL Madeena Al Ba'eeda", views: "5.93M", likes: "15095", avgViewsPerClip: "28353" },
                { rank: 2, title: "Ommi", views: "2.85M", likes: "10211", avgViewsPerClip: "13527" },
                { rank: 3, title: "FIFA Club World Cup 2025", views: "1.9M", likes: "5586", avgViewsPerClip: "8885" },
                { rank: 4, title: "Fondooq Al Ahlam", views: "1.54M", likes: "4731", avgViewsPerClip: "29657" },
                { rank: 5, title: "Leyla", views: "0.93M", likes: "2265", avgViewsPerClip: "11876" },
                { rank: 6, title: "Aser", views: "0.67M", likes: "1906", avgViewsPerClip: "4258" },
                { rank: 7, title: "Fareed Season 3", views: "0.41M", likes: "825", avgViewsPerClip: "5392" },
                { rank: 8, title: "Laylet El Eid", views: "0.28M", likes: "465", avgViewsPerClip: "16519" },
                { rank: 9, title: "Harb El Gibali", views: "0.25M", likes: "594", avgViewsPerClip: "3400" },
                { rank: 10, title: "Ghayeb Fi Bilad Al Ajayeb", views: "0.24M", likes: "414", avgViewsPerClip: "2837" }
            ];

            // Data for Leyla shorts (extracted from image_25dc93.png)
            const leylaShortsData = [
                { title: "خطة ليلي", views: 84579 },
                { title: "الشغل لسا ما انتهى", views: 57890 },
                { title: "ليلى وكلام قوي جداً", views: 19239 },
                { title: "أنا بعرف منيح شو بدها", views: 17080 },
                { title: "الم الماضي و الحاضر", views: 15537 },
                { title: "خطة نور المحكمة", views: 14582 },
                { title: "مشهد رومانسي ❤️", views: 13623 },
                { title: "عشاء تعارف لخطبة مالي", views: 13380 },
                { title: "تصعيد قوي جداً", views: 13206 },
                { title: "الذكريات الحلوة", views: 12049 },
                { title: "حادث بالمزبلة", views: 11825 },
                { title: "نور بتحكم في مالي و تتذكر ابنها", views: 11418 },
                { title: "نور تحاول التقرب من جينو", views: 10530 },
                { title: "لازم نحل القصة ❌", views: 10270 },
                { title: "القدر يجمعهم", views: 9832 },
                { title: "نور بدها تاخد ابنها", views: 9383 },
                { title: "الام ما بتعود", views: 4117 },
                { title: "قصة الكازوز", views: 3803 },
                { title: "موقف محرج جداً", views: 2834 },
                { title: "نور وقعت بمشكلة ما رح تقدر تخرج منها بسهولة!", views: 419 }
            ];


            const dayNames = ['Sunday', 'Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday'];

            let averageViewsChart;
            let rangeViewsChart;
            let dailyViewsChart;
            let topTitlesViewsChart; // New chart instance
            let lowAvgViewsChart; // New chart for low performing titles

            // Data for the Clip Performance Analysis (Third Party Views - July)
            // Updated based on user provided accurate data
            const thirdPartyJulyProfileData = [
                { name: "AL Kha'en", clips: 18, totalViews: 24306, avgViews: 0 },
                { name: "Ahla Ma Tash", clips: 17, totalViews: 30354, avgViews: 0 },
                { name: "Al -Meerath", clips: 19, totalViews: 109706, avgViews: 0 },
                { name: "Al Ameel (Icerde)", clips: 13, totalViews: 82875, avgViews: 0 },
                { name: "Al Atawla", clips: 18, totalViews: 26381, avgViews: 0 },
                { name: "Al Hayba", clips: 7, totalViews: 4373, avgViews: 0 },
                { name: "Al Khotta Baa", clips: 13, totalViews: 33551, avgViews: 0 },
                { name: "Al Le'ba: Level Al Wahsh", clips: 19, totalViews: 19985, avgViews: 0 },
                { name: "Al Qadar", clips: 17, totalViews: 35918, avgViews: 0 },
                { name: "Amr Ikhlaa S3", clips: 13, totalViews: 14855, avgViews: 0 },
                { name: "Awdat Khalati", clips: 22, totalViews: 24148, avgViews: 0 },
                { name: "Bab Al Hara", clips: 9, totalViews: 2683, avgViews: 0 },
                { name: "Bait & So'al 2025 EP29 Clip 1", clips: 3, totalViews: 384, avgViews: 0 },
                { name: "Banat Al Thanawi", clips: 14, totalViews: 20044, avgViews: 0 },
                { name: "Beyt Al Ankaboot", clips: 14, totalViews: 7178, avgViews: 0 },
                { name: "Big Time Podcast", clips: 16, totalViews: 44796, avgViews: 0 },
                { name: "El Hashashin", clips: 19, totalViews: 19483, avgViews: 0 },
                { name: "El Kebeer Awi_TV", clips: 16, totalViews: 717, avgViews: 0 },
                { name: "Fareed S3", clips: 17, totalViews: 95585, avgViews: 0 },
                { name: "Gaafar El Omda", clips: 20, totalViews: 23013, avgViews: 0 },
                { name: "Gamgoum Wa Bimbim: Al Sharika Al Almaniya Li Mokafahat Al Khawareq", clips: 5, totalViews: 4058, avgViews: 0 },
                { name: "Horouj", clips: 11, totalViews: 6778, avgViews: 0 },
                { name: "Kermal Al Walad", clips: 11, totalViews: 27929, avgViews: 0 },
                { name: "Kolna Eyal Qarya", clips: 16, totalViews: 67047, avgViews: 0 },
                { name: "Leyla", clips: 20, totalViews: 335596, avgViews: 0 },
                { name: "Lil Mawt", clips: 18, totalViews: 40959, avgViews: 0 },
                { name: "Mama Ghaneema Season 1", clips: 4, totalViews: 23299, avgViews: 0 },
                { name: "Melh Wa Samra Season 1", clips: 12, totalViews: 9616, avgViews: 0 },
                { name: "Min Share’ Al Haram Ela... Season 1", clips: 15, totalViews: 47750, avgViews: 0 },
                { name: "Moftaraq Toroq Season 1", clips: 18, totalViews: 22786, avgViews: 0 },
                { name: "MotorShow DocuSeries", clips: 3, totalViews: 17013, avgViews: 0 },
                { name: "My Grandfather's Museum Season 1", clips: 7, totalViews: 14174, avgViews: 0 },
                { name: "Ragel We Set Settat Season 1", clips: 14, totalViews: 10230, avgViews: 0 },
                { name: "Salon Zahra Season 2", clips: 16, totalViews: 22236, avgViews: 0 },
                { name: "Shatti Ya Beirut", clips: 20, totalViews: 41951, avgViews: 0 },
                { name: "Sikkat Safar Season 1", clips: 17, totalViews: 22032, avgViews: 0 },
                { name: "Tash: Al Awda Season 19", clips: 10, totalViews: 433, avgViews: 0 },
                { name: "Top Chef Season 8", clips: 5, totalViews: 10073, avgViews: 0 },
                { name: "Wlad Badee'a Season 1", clips: 21, totalViews: 7647, avgViews: 0 },
                { name: "Zawja Waheda La Takfi Season 1", clips: 4, totalViews: 31297, avgViews: 0 }
            ];

            // Recalculate avgViews for each entry
            thirdPartyJulyProfileData.forEach(item => {
                item.avgViews = item.clips > 0 ? item.totalViews / item.clips : 0;
            });

            const updatedTotalProfiles = 40;
            const updatedTotalClips = 544;
            const updatedTotalViews = 1383239; // Updated total views based on user input


            // Helper function to format large numbers
            function formatViews(views) {
                if (views >= 1000000) {
                    return (views / 1000000).toFixed(2) + 'M+';
                } else if (views >= 1000) {
                    return (views / 1000).toFixed(1) + 'K+';
                }
                return views.toLocaleString();
            }


            const clipPerformancePalette = {
                blueDark: '#005f73',
                blueMid: '#0a9396',
                blueLight: '#94d2bd',
                yellowLight: '#e9d8a6',
                yellowMid: '#ee9b00',
                orangeMid: '#ca6702',
                orangeDark: '#bb3e03',
                redMid: '#ae2012',
                redDark: '#9b2226'
            };

            const clipPerformanceChartColors = [clipPerformancePalette.blueMid, clipPerformancePalette.yellowMid, clipPerformancePalette.orangeMid, clipPerformancePalette.blueLight, clipPerformancePalette.redMid, clipPerformancePalette.blueDark, clipPerformancePalette.orangeDark, clipPerformancePalette.yellowLight, clipPerformancePalette.redDark, clipPerformancePalette.blueMid];


            const processOverallData = (data) => {
                const viewsByDay = {};
                data.forEach(d => {
                    if (!viewsByDay[d.day]) {
                        viewsByDay[d.day] = [];
                    }
                    viewsByDay[d.day].push(d.views);
                });

                const avgData = dayNames.map(day => {
                    const views = viewsByDay[day] || [];
                    return views.length > 0 ? views.reduce((sum, v) => sum + v, 0) / views.length : 0;
                });

                const rangeData = dayNames.map(day => {
                    const views = viewsByDay[day] || [];
                    if (views.length === 0) return [0, 0];
                    return [Math.min(...views), Math.max(...views)];
                });

                return { labels: dayNames, avgData, rangeData };
            };

            const processDailyDataForWeek = (weekNumber) => {
                let dataSubset = [];
                if (weekNumber === 'all') { // This case is now for internal data processing if needed
                    dataSubset = fullDailyData;
                } else {
                    const startIndex = (weekNumber - 1) * 7;
                    dataSubset = fullDailyData.slice(startIndex, startIndex + 7);
                }
                const labels = dataSubset.map(d => `${d.date} (${d.day.substring(0, 3)})`);
                const views = dataSubset.map(d => d.views);
                return { labels, views, rawData: dataSubset };
            };

            const updateKPIs = (data) => {
                if (data.length === 0) {
                    document.getElementById('kpiHighest').textContent = 'N/A';
                    document.getElementById('kpiHighestDay').textContent = '';
                    document.getElementById('kpiLowest').textContent = 'N/A';
                    document.getElementById('kpiLowestDay').textContent = '';
                    document.getElementById('kpiMidWeekAvg').textContent = 'N/A';
                    document.getElementById('kpiWeekendAvg').textContent = 'N/A';
                    return;
                }

                let highestView = 0;
                let highestDay = '';
                let lowestView = Infinity;
                let lowestDay = '';

                data.forEach(d => {
                    if (d.views > highestView) {
                        highestView = d.views;
                        highestDay = `${d.date} (${d.day})`;
                    }
                    if (d.views < lowestView) {
                        lowestView = d.views;
                        lowestDay = `${d.date} (${d.day})`;
                    }
                });

                const midWeekViews = data.filter(d => ['Tuesday', 'Wednesday', 'Thursday'].includes(d.day)).map(d => d.views);
                const weekendViews = data.filter(d => ['Saturday', 'Sunday'].includes(d.day)).map(d => d.views);

                const avgMidWeek = midWeekViews.length > 0 ? midWeekViews.reduce((sum, v) => sum + v, 0) / midWeekViews.length : 0;
                const avgWeekend = weekendViews.length > 0 ? weekendViews.reduce((sum, v) => sum + v, 0) / weekendViews.length : 0;

                document.getElementById('kpiHighest').textContent = `${highestView}K`;
                document.getElementById('kpiHighestDay').textContent = `on ${highestDay}`;
                document.getElementById('kpiLowest').textContent = `${lowestView}K`;
                document.getElementById('kpiLowestDay').textContent = `on ${lowestDay}`;
                document.getElementById('kpiMidWeekAvg').textContent = `${avgMidWeek.toFixed(0)}K`;
                document.getElementById('kpiWeekendAvg').textContent = `${avgWeekend.toFixed(0)}K`;
            };

            const chartClickHandler = (evt, elements, chart) => {
                if (elements.length > 0) {
                    const dataIndex = elements[0].index;
                    const clickedLabel = chart.data.labels[dataIndex];
                    let targetDayFull;

                    if (clickedLabel.includes('(') && clickedLabel.includes(')')) {
                        // Format: "Jun 1 (Sun)"
                        const dayAbbr = clickedLabel.match(/\((.*?)\)/)[1];
                        targetDayFull = dayNames.find(d => d.startsWith(dayAbbr));
                    } else {
                        // Format: "Sunday"
                        targetDayFull = clickedLabel;
                    }
                    
                    const recommendations = document.querySelectorAll('.accordion-item');
                    recommendations.forEach(rec => {
                        const recDays = rec.dataset.day.split(',');
                        if (recDays.includes(targetDayFull)) {
                            rec.scrollIntoView({ behavior: 'smooth', block: 'center' });
                            rec.classList.add('highlight');
                            const accordionHeader = rec.querySelector('.accordion-header');
                            const accordionContent = rec.querySelector('.accordion-content');
                            if (accordionContent.style.maxHeight) {
                                // Already open, just highlight
                            } else {
                                accordionHeader.click();
                            }
                            setTimeout(() => rec.classList.remove('highlight'), 1500);
                        }
                    });
                }
            };

            const createChart = (ctx, type, data, options) => {
                return new Chart(ctx, { type, data, options });
            };

            const baseOptions = {
                maintainAspectRatio: false,
                responsive: true,
                plugins: {
                    legend: {
                        display: false
                    },
                    tooltip: {
                        backgroundColor: '#0f172a', // slate-900
                        titleFont: { weight: 'bold' },
                        bodyFont: { size: 14 },
                        padding: 12,
                        cornerRadius: 8,
                        displayColors: false,
                    }
                },
                scales: {
                    y: {
                        beginAtZero: true,
                        grid: {
                            color: '#e2e8f0' // slate-200
                        },
                        ticks: {
                            color: '#64748b', // slate-500
                            callback: function(value) {
                                return value + 'K';
                            }
                        },
                        title: {
                            display: true,
                            text: 'Views (in Thousands)',
                            color: '#475569', // slate-600
                            font: {
                                weight: 'semibold'
                            }
                        }
                    },
                    x: {
                        grid: {
                            display: false
                        },
                        ticks: {
                             color: '#64748b' // slate-500
                        }
                    }
                }
            };

            // Initialize Overall Charts (Average and Range)
            const avgCtx = document.getElementById('averageViewsChart').getContext('2d');
            const avgChartOptions = {
                ...baseOptions,
                onClick: chartClickHandler,
                plugins: {
                    ...baseOptions.plugins,
                    tooltip: {
                        ...baseOptions.plugins.tooltip,
                        callbacks: {
                            label: function(context) {
                                return `Avg. Views: ${context.parsed.y.toFixed(0)}K`;
                            }
                        }
                    }
                }
            };
            averageViewsChart = createChart(avgCtx, 'bar', {
                labels: processOverallData(fullDailyData).labels,
                datasets: [{
                    label: 'Average Views',
                    data: processOverallData(fullDailyData).avgData,
                    backgroundColor: 'rgba(14, 165, 233, 0.6)', // sky-500
                    borderColor: 'rgba(14, 165, 233, 1)',
                    borderWidth: 2,
                    borderRadius: 4,
                }]
            }, avgChartOptions);

            const rangeCtx = document.getElementById('rangeViewsChart').getContext('2d');
            const rangeChartOptions = {
                 ...baseOptions,
                onClick: chartClickHandler,
                scales: {
                    ...baseOptions.scales,
                    y: {
                        ...baseOptions.scales.y,
                        beginAtZero: false
                    }
                },
                plugins: {
                     ...baseOptions.plugins,
                    tooltip: {
                         ...baseOptions.plugins.tooltip,
                         callbacks: {
                            label: function(context) {
                                const range = context.raw;
                                return `Views Range: ${range[0]}K - ${range[1]}K`;
                            }
                        }
                    }
                }
            };
            rangeViewsChart = createChart(rangeCtx, 'bar', {
                labels: processOverallData(fullDailyData).labels,
                datasets: [{
                    label: 'Viewership Range',
                    data: processOverallData(fullDailyData).rangeData,
                    backgroundColor: 'rgba(245, 158, 11, 0.6)', // amber-500
                    borderColor: 'rgba(245, 158, 11, 1)',
                    borderWidth: 2,
                    borderRadius: 4,
                    borderSkipped: false,
                }]
            }, rangeChartOptions);

            // Initialize Daily Views Chart
            const dailyCtx = document.getElementById('dailyViewsChart').getContext('2d');
            const dailyChartOptions = {
                ...baseOptions,
                onClick: chartClickHandler,
                plugins: {
                    ...baseOptions.plugins,
                    tooltip: {
                        ...baseOptions.plugins.tooltip,
                        callbacks: {
                            label: function(context) {
                                return `Daily Views: ${context.parsed.y.toFixed(0)}K`;
                            }
                        }
                    }
                },
                scales: {
                    ...baseOptions.scales,
                    x: {
                        ...baseOptions.scales.x,
                        ticks: {
                            color: '#64748b',
                            maxRotation: 45,
                            minRotation: 45
                        }
                    }
                }
            };
            dailyViewsChart = createChart(dailyCtx, 'bar', {
                labels: [],
                datasets: [{
                    label: 'Daily Views',
                    data: [],
                    backgroundColor: 'rgba(16, 185, 129, 0.6)', // emerald-500
                    borderColor: 'rgba(16, 185, 129, 1)',
                    borderWidth: 2,
                    borderRadius: 4,
                }]
            }, dailyChartOptions);

            // Initial data for Top Titles Chart
            const initialTopTitlesLabels = top10TitlesData.map(item => item.title);
            const initialTopTitlesViews = top10TitlesData.map(item => parseFloat(item.views.replace('M', '')) * 1000000);

            // Initialize Top Titles Views Chart
            const topTitlesCtx = document.getElementById('topTitlesViewsChart').getContext('2d');
            const topTitlesChartOptions = {
                ...baseOptions,
                indexAxis: 'y', // Make it a horizontal bar chart
                scales: {
                    x: {
                        beginAtZero: true,
                        grid: {
                            color: '#e2e8f0'
                        },
                        ticks: {
                            color: '#64748b',
                            callback: function(value) {
                                // Convert to millions for display
                                return (value / 1000000) + 'M';
                            }
                        },
                        title: {
                            display: true,
                            text: 'Total Views',
                            color: '#475569',
                            font: {
                                weight: 'semibold'
                            }
                        }
                    },
                    y: {
                        grid: {
                            display: false
                        },
                        ticks: {
                            color: '#64748b'
                        }
                    }
                },
                plugins: {
                    ...baseOptions.plugins,
                    tooltip: {
                        ...baseOptions.plugins.tooltip,
                        callbacks: {
                            label: function(context) {
                                return `Total Views: ${context.parsed.x / 1000000}M`;
                            }
                        }
                    }
                },
                // Added options for bar thickness
                barThickness: 30, // Fixed thickness for bars
                categoryPercentage: 0.8, // Adjust space between bars
                barPercentage: 0.9, // Adjust width of the bar itself
                onClick: (evt, elements) => { // Custom onClick for topTitlesViewsChart
                    showDebugMessage("Chart click event triggered on June Top Titles Chart.");
                    if (elements.length > 0) {
                        const dataIndex = elements[0].index;
                        const clickedTitle = topTitlesViewsChart.data.labels[dataIndex];
                        showDebugMessage("Clicked title on June Top Titles Chart: " + clickedTitle);
                        // This chart no longer triggers the Leyla modal directly.
                        // It will just filter the chart to show only the clicked title.
                        const titleData = top10TitlesData.find(t => t.title === clickedTitle);
                        if (titleData) {
                            displaySingleTitleOnChart(titleData.title, titleData.views);
                        }
                    } else {
                        showDebugMessage("No element clicked on June Top Titles Chart.");
                    }
                }
            };

            topTitlesViewsChart = createChart(topTitlesCtx, 'bar', {
                labels: initialTopTitlesLabels,
                datasets: [{
                    label: 'Total Views',
                    data: initialTopTitlesViews,
                    backgroundColor: 'rgba(79, 70, 229, 0.6)', // indigo-500
                    borderColor: 'rgba(79, 70, 229, 1)',
                    borderWidth: 2,
                    borderRadius: 4,
                }]
            }, topTitlesChartOptions);

            // Function to update Top Titles Chart for a single title
            const displaySingleTitleOnChart = (title, views) => {
                topTitlesViewsChart.data.labels = [title];
                topTitlesViewsChart.data.datasets[0].data = [parseFloat(views.replace('M', '')) * 1000000];
                topTitlesViewsChart.update();
            };

            // Function to display all titles on the chart
            const displayAllTitlesOnChart = () => {
                topTitlesViewsChart.data.labels = initialTopTitlesLabels;
                topTitlesViewsChart.data.datasets[0].data = initialTopTitlesViews;
                topTitlesViewsChart.update();
            };


            const updateDailyViewsChart = (weekNumber) => {
                const processedDailyData = processDailyDataForWeek(weekNumber);
                dailyViewsChart.data.labels = processedDailyData.labels;
                dailyViewsChart.data.datasets[0].data = processedDailyData.views;
                dailyViewsChart.update();
            };

            // Tab functionality for Overall Chart Type (Average vs. Range)
            const avgBtn = document.getElementById('avgBtn');
            const rangeBtn = document.getElementById('rangeBtn');
            const avgChartContainer = document.getElementById('avgChartContainer');
            const rangeChartContainer = document.getElementById('rangeChartContainer');

            // Check if these elements exist before adding listeners
            if (avgBtn && rangeBtn && avgChartContainer && rangeChartContainer) {
                avgBtn.addEventListener('click', () => {
                    avgChartContainer.classList.remove('hidden');
                    rangeChartContainer.classList.add('hidden');
                    avgBtn.classList.add('bg-white', 'text-sky-600', 'shadow-sm', 'font-semibold');
                    avgBtn.classList.remove('text-slate-600', 'font-medium');
                    rangeBtn.classList.remove('bg-white', 'text-sky-600', 'shadow-sm', 'font-semibold');
                    rangeBtn.classList.add('text-slate-600', 'font-medium');
                });

                rangeBtn.addEventListener('click', () => {
                    rangeChartContainer.classList.remove('hidden');
                    avgChartContainer.classList.add('hidden');
                    rangeBtn.classList.add('bg-white', 'text-sky-600', 'shadow-sm', 'font-semibold');
                    rangeBtn.classList.remove('text-slate-600', 'font-medium');
                    avgBtn.classList.remove('bg-white', 'text-sky-600', 'shadow-sm', 'font-semibold');
                    avgBtn.classList.add('text-slate-600', 'font-medium');
                });
            }
            
            // Tab functionality for Weekly Daily Data
            const weeklyDailyButtons = document.querySelectorAll('.weekly-daily-btn');
            const dailyChartSection = document.getElementById('dailyChartContainer'); // Get the chart container

            weeklyDailyButtons.forEach(button => {
                button.addEventListener('click', () => {
                    weeklyDailyButtons.forEach(btn => {
                        btn.classList.remove('bg-white', 'text-sky-600', 'shadow-sm', 'font-semibold');
                        btn.classList.add('text-slate-600', 'font-medium');
                    });
                    button.classList.add('bg-white', 'text-sky-600', 'shadow-sm', 'font-semibold');
                    button.classList.remove('text-slate-600', 'font-medium');

                    let selectedWeek = parseInt(button.id.replace('week', '').replace('DailyBtn', ''));
                    
                    // Show the chart container when a button is clicked
                    if (dailyChartSection) {
                        dailyChartSection.classList.remove('hidden');
                    }
                    updateDailyViewsChart(selectedWeek);
                });
            });

            // Top-level Main Tab functionality (for Monthly Highlights, Top 10 Titles, Recommendation Titles)
            const mainTabButtons = document.querySelectorAll('.main-tab-btn');
            const mainContentSections = document.querySelectorAll('.main-content-section');

            mainTabButtons.forEach(button => {
                button.addEventListener('click', () => {
                    // Deactivate all main tab buttons
                    mainTabButtons.forEach(btn => {
                        btn.classList.remove('bg-white', 'text-sky-600', 'shadow-sm', 'font-semibold');
                        btn.classList.add('text-slate-600', 'font-medium');
                    });

                    // Activate clicked button
                    button.classList.add('bg-white', 'text-sky-600', 'shadow-sm', 'font-semibold');
                    button.classList.remove('text-slate-600', 'font-medium');

                    // Hide all content sections
                    mainContentSections.forEach(section => {
                        section.classList.add('hidden');
                    });

                    // Show the target section
                    const targetSectionId = button.dataset.target;
                    const sectionToShow = document.getElementById(targetSectionId);
                    if (sectionToShow) {
                        sectionToShow.classList.remove('hidden');

                        // Specific update for the Top 10 Titles chart when its section becomes visible
                        if (targetSectionId === 'top-titles-section' && topTitlesViewsChart) {
                            // Use a small timeout to ensure the canvas is fully visible before resizing
                            setTimeout(() => {
                                const canvasElement = topTitlesViewsChart.canvas;
                                if (canvasElement && canvasElement.offsetParent !== null) { // Check if canvas is visible
                                    topTitlesViewsChart.resize();
                                    topTitlesViewsChart.update();
                                    showDebugMessage("Top Titles Chart resized and updated after tab switch.");
                                } else {
                                    showDebugMessage("Top Titles Chart canvas not visible for resize.");
                                }
                            }, 100); // Increased delay
                        }
                    }
                });
            });


            // Accordion functionality
            document.querySelectorAll('.accordion-header').forEach(header => {
                header.addEventListener('click', () => {
                    const content = header.nextElementSibling;
                    const icon = header.querySelector('span');

                    // Close all others
                    document.querySelectorAll('.accordion-content').forEach(c => {
                        if (c !== content) {
                            c.style.maxHeight = null;
                            const otherIcon = c.previousElementSibling ? c.previousElementSibling.querySelector('span') : null;
                            if (otherIcon) {
                                otherIcon.classList.remove('rotate-180');
                            }
                        }
                    });

                    // Toggle current
                    if (content.style.maxHeight) {
                        content.style.maxHeight = null;
                        icon.classList.remove('rotate-180');
                    } else {
                        content.style.maxHeight = content.scrollHeight + 'px';
                        icon.classList.add('rotate-180');
                    }
                });
            });

            // Function to populate the Top 10 Titles table
            const populateTopTitlesTable = () => {
                const tableBody = document.getElementById('topTitlesTableBody');
                if (!tableBody) return; // Exit if element not found
                tableBody.innerHTML = ''; // Clear existing rows

                top10TitlesData.forEach(item => {
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td class="px-4 py-2 whitespace-nowrap">${item.rank}</td>
                        <td class="px-4 py-2 whitespace-nowrap">${item.title}</td>
                        <td class="px-4 py-2 whitespace-nowrap">${item.views}</td>
                        <td class="px-4 py-2 whitespace-nowrap">${item.likes}</td>
                        <td class="px-4 py-2 whitespace-nowrap">${item.avgViewsPerClip}</td>
                    `;
                    // Add click listener to each row
                    row.addEventListener('click', () => {
                        showDebugMessage("Table row click event triggered for: " + item.title + " (June Top Titles)");
                        // This table row no longer triggers the Leyla modal directly.
                        displaySingleTitleOnChart(item.title, item.views);
                    });
                    tableBody.appendChild(row);
                });
            };

            // Event listener for "Show All Titles" button
            const showAllTitlesBtn = document.getElementById('showAllTitlesBtn');
            if (showAllTitlesBtn) {
                showAllTitlesBtn.addEventListener('click', displayAllTitlesOnChart);
            }

            // New Top-Level Report Navigation Logic (for June/July Performance, DMCS, Third Party, Additional Insights)
            const reportNavButtons = document.querySelectorAll('.report-nav-btn');
            const reportContentSections = document.querySelectorAll('.report-content-section');

            reportNavButtons.forEach(button => {
                button.addEventListener('click', (event) => {
                    const targetSectionId = button.dataset.target; // For internal section toggling

                    // Deactivate all report nav buttons that toggle sections
                    reportNavButtons.forEach(btn => {
                        btn.classList.remove('bg-sky-600', 'text-white', 'shadow-sm', 'font-semibold');
                        btn.classList.add('bg-slate-200', 'text-slate-800', 'font-medium', 'hover:bg-slate-300');
                    });

                    // Activate clicked button visually
                    button.classList.add('bg-sky-600', 'text-white', 'shadow-sm', 'font-semibold');
                    button.classList.remove('bg-slate-200', 'text-slate-800', 'font-medium', 'hover:bg-slate-300');

                    // Hide all report content sections
                    reportContentSections.forEach(section => {
                        section.classList.add('hidden');
                    });

                    // Show the target report content section
                    const sectionToShow = document.getElementById(targetSectionId);
                    if (sectionToShow) {
                        sectionToShow.classList.remove('hidden');
                        // If it's the third-party-july-content, initialize its charts and generate recommendations
                        if (targetSectionId === 'third-party-july-content') {
                            showDebugMessage("Navigated to Third Party Views - July. Initializing charts.");
                            // Update KPIs for Third Party Views - July
                            document.getElementById('total-profiles').textContent = updatedTotalProfiles;
                            document.getElementById('total-clips').textContent = updatedTotalClips;
                            document.getElementById('total-views').textContent = formatViews(updatedTotalViews); // Use the formatViews function

                            // Increased timeout to give the browser more time to render elements
                            setTimeout(() => { 
                                initializeThirdPartyJulyCharts();
                                populateLowTitlesTable(); // Populate low titles table
                                populateTopTotalViewsTable(); // Populate the new table
                            }, 500); // Increased timeout to 500ms
                        } else {
                            showDebugMessage(`Navigated to ${targetSectionId}.`);
                        }
                    }
                });
            });

            // Add event listeners for the DMCS dropdown menu items
            document.querySelectorAll('.dropdown-menu-item').forEach(item => {
                item.addEventListener('click', (event) => {
                    event.preventDefault(); // Prevent default link behavior
                    const targetSectionId = event.target.dataset.targetSection;
                    showDebugMessage(`Clicked DMCS dropdown item: ${targetSectionId}`);

                    // Deactivate all report nav buttons
                    reportNavButtons.forEach(btn => {
                        btn.classList.remove('bg-sky-600', 'text-white', 'shadow-sm', 'font-semibold');
                        btn.classList.add('bg-slate-200', 'text-slate-800', 'font-medium', 'hover:bg-slate-300');
                    });

                    // Activate the DMCS Views button visually
                    const dmcsViewsBtn = document.getElementById('dmcsViewsBtn');
                    if (dmcsViewsBtn) {
                        dmcsViewsBtn.classList.add('bg-sky-600', 'text-white', 'shadow-sm', 'font-semibold');
                        dmcsViewsBtn.classList.remove('bg-slate-200', 'text-slate-800', 'font-medium', 'hover:bg-slate-300');
                    }

                    // Hide all report content sections
                    reportContentSections.forEach(section => {
                        section.classList.add('hidden');
                    });

                    // Show the target DMCS content section
                    const sectionToShow = document.getElementById(targetSectionId);
                    if (sectionToShow) {
                        sectionToShow.classList.remove('hidden');
                    }
                });
            });

            // Event listeners for Third Party Overview month buttons
            document.querySelectorAll('.third-party-month-btn').forEach(button => {
                button.addEventListener('click', () => {
                    const targetSectionId = button.dataset.targetSection;
                    showDebugMessage(`Clicked Third Party month button: ${targetSectionId}`);
                    
                    // Hide all report content sections
                    reportContentSections.forEach(section => {
                        section.classList.add('hidden');
                    });

                    // Show the target section
                    const sectionToShow = document.getElementById(targetSectionId);
                    if (sectionToShow) {
                        sectionToShow.classList.remove('hidden');
                        // If it's the third-party-july-content, initialize its charts and generate recommendations
                        if (targetSectionId === 'third-party-july-content') {
                            showDebugMessage("Navigated to Third Party Views - July from month button. Initializing charts.");
                            // Update KPIs for Third Party Views - July
                            document.getElementById('total-profiles').textContent = updatedTotalProfiles;
                            document.getElementById('total-clips').textContent = updatedTotalClips;
                            document.getElementById('total-views').textContent = formatViews(updatedTotalViews); // Use the formatViews function

                            setTimeout(() => { 
                                initializeThirdPartyJulyCharts();
                                populateLowTitlesTable(); // Populate low titles table
                                populateTopTotalViewsTable(); // Populate the new table
                            }, 500); // Increased timeout to 500ms
                        }
                    }
                });
            });

            // Event listeners for "Back to Dashboard" buttons within sections
            document.querySelectorAll('.back-to-main-dashboard').forEach(button => {
                button.addEventListener('click', () => {
                    showDebugMessage("Clicked 'Back to Dashboard' button.");
                    // Hide all report content sections
                    reportContentSections.forEach(section => {
                        section.classList.add('hidden');
                    });
                    // Show the main dashboard content (June Performance Analysis)
                    const juneReportContent = document.getElementById('june-report-content');
                    if (juneReportContent) {
                        juneReportContent.classList.remove('hidden');
                    }

                    // Reset active state for top-level nav buttons
                    reportNavButtons.forEach(btn => {
                        btn.classList.remove('bg-sky-600', 'text-white', 'shadow-sm', 'font-semibold');
                        btn.classList.add('bg-slate-200', 'text-slate-800', 'font-medium', 'hover:bg-slate-300');
                    });
                    const juneReportBtn = document.getElementById('juneReportBtn');
                    if (juneReportBtn) {
                        juneReportBtn.classList.add('bg-sky-600', 'text-white', 'shadow-sm', 'font-semibold');
                        juneReportBtn.classList.remove('bg-slate-200', 'text-slate-800', 'font-medium', 'hover:bg-slate-300');
                    }
                });
            });


            // Function to initialize charts for Third Party Views - July
            function initializeThirdPartyJulyCharts() {
                showDebugMessage("Running initializeThirdPartyJulyCharts().");
                // Destroy existing chart instances if they exist to prevent duplicates
                if (window.totalViewsChartInstance) {
                    window.totalViewsChartInstance.destroy();
                    showDebugMessage("Destroyed existing totalViewsChartInstance.");
                }
                if (window.avgViewsChartInstance) {
                    window.avgViewsChartInstance.destroy();
                    showDebugMessage("Destroyed existing avgViewsChartInstance.");
                }
                if (window.lowAvgViewsChartInstance) {
                    window.lowAvgViewsChartInstance.destroy();
                    showDebugMessage("Destroyed existing lowAvgViewsChartInstance.");
                }

                // Ensure canvases exist and their getContext method is available before trying to get context
                const totalViewsCanvas = document.getElementById('totalViewsChart');
                const avgViewsCanvas = document.getElementById('avgViewsChart');
                const lowAvgViewsCanvas = document.getElementById('lowAvgViewsChart'); // New chart context

                const totalViewsCtx = totalViewsCanvas && totalViewsCanvas.getContext ? totalViewsCanvas.getContext('2d') : null;
                const avgViewsCtx = avgViewsCanvas && avgViewsCanvas.getContext ? avgViewsCanvas.getContext('2d') : null;
                const lowAvgViewsCtx = lowAvgViewsCanvas && lowAvgViewsCanvas.getContext ? lowAvgViewsCanvas.getContext('2d') : null;

                if (!totalViewsCtx || !avgViewsCtx || !lowAvgViewsCtx) {
                    showDebugMessage("ERROR: One or more chart canvases for Third Party Views - July not found or not ready.");
                    return;
                }

                const formatClipLabel = (label, charLimit = 16) => {
                    if (typeof label !== 'string' || label.length <= charLimit) {
                        return label;
                    }
                    const words = label.split(' ');
                    const lines = [];
                    let currentLine = '';
                    for (const word of words) {
                        if ((currentLine + ' ' + word).length > charLimit) {
                            lines.push(currentLine.trim());
                            currentLine = word;
                        } else {
                            currentLine += (currentLine ? ' ' : '') + word;
                        }
                    }
                    if (currentLine) {
                        lines.push(currentLine.trim());
                    }
                    return lines;
                };

                const clipSharedTooltipConfig = {
                    plugins: {
                        tooltip: {
                            callbacks: {
                                title: function(tooltipItems) {
                                    const item = tooltipItems[0];
                                    let label = item.chart.data.labels[item.dataIndex];
                                    return Array.isArray(label) ? label.join(' ') : label;
                                }
                            }
                        }
                    }
                };

                const sortedByTotalViews = [...thirdPartyJulyProfileData].sort((a, b) => b.totalViews - a.totalViews).slice(0, 10);
                window.totalViewsChartInstance = new Chart(totalViewsCtx, {
                    type: 'bar',
                    data: {
                        labels: sortedByTotalViews.map(p => formatClipLabel(p.name, 20)),
                        datasets: [{
                            label: 'Total Views',
                            data: sortedByTotalViews.map(p => p.totalViews),
                            backgroundColor: clipPerformanceChartColors,
                            borderColor: 'rgba(255, 255, 255, 0.2)',
                            borderWidth: 1
                        }]
                    },
                    options: { ...clipSharedTooltipConfig,
                        indexAxis: 'y',
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: { ...clipSharedTooltipConfig.plugins,
                            legend: { display: false },
                            title: { display: true, text: 'Top 10 Profiles by Total Views', font: { size: 16 }, color: clipPerformancePalette.blueDark }
                        },
                        scales: {
                            x: { title: { display: true, text: 'Total Views' }, grid: { color: '#e5e7eb' } },
                            y: { grid: { display: false } }
                        },
                        onClick: (evt, elements) => { // New onClick for totalViewsChartInstance
                            showDebugMessage("Chart click event triggered on July Total Views Chart.");
                            if (elements.length > 0) {
                                const dataIndex = elements[0].index;
                                const clickedTitle = window.totalViewsChartInstance.data.labels[dataIndex];
                                // If the label is an array (due to formatClipLabel), join it back to a string for comparison
                                const cleanClickedTitle = Array.isArray(clickedTitle) ? clickedTitle.join(' ') : clickedTitle;
                                showDebugMessage("Clicked title on July Total Views Chart: " + cleanClickedTitle);
                                if (cleanClickedTitle.includes("Leyla")) { // Use .includes for partial match due to formatting
                                    showDebugMessage("Calling showShortsModal for Leyla from July Total Views Chart click.");
                                    showShortsModal("Leyla", leylaShortsData);
                                } else {
                                    showDebugMessage("Clicked on a title other than Leyla on July Total Views Chart.");
                                }
                            } else {
                                showDebugMessage("No element clicked on July Total Views Chart.");
                            }
                        }
                    }
                });
                
                const sortedByAvgViews = [...thirdPartyJulyProfileData].sort((a, b) => b.avgViews - a.avgViews).slice(0, 10);
                window.avgViewsChartInstance = new Chart(avgViewsCtx, {
                    type: 'bar',
                    data: {
                        labels: sortedByAvgViews.map(p => formatClipLabel(p.name, 20)),
                        datasets: [{
                            label: 'Average Views per Clip',
                            data: sortedByAvgViews.map(p => p.avgViews),
                            backgroundColor: clipPerformanceChartColors.slice().reverse(),
                            borderColor: 'rgba(255, 255, 255, 0.2)',
                            borderWidth: 1
                        }]
                    },
                    options: { ...clipSharedTooltipConfig,
                        indexAxis: 'y',
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: { ...clipSharedTooltipConfig.plugins,
                            legend: { display: false },
                            title: { display: true, text: 'Top 10 Profiles by Average Views per Clip', font: { size: 16 }, color: clipPerformancePalette.blueDark }
                        },
                        scales: {
                            x: { title: { display: true, text: 'Average Views per Clip' }, grid: { color: '#e5e7eb' } },
                            y: { grid: { display: false } }
                        }
                    }
                });

                // New chart for Low 5 Titles by Average Views
                const sortedByAvgViewsAsc = [...thirdPartyJulyProfileData].sort((a, b) => a.avgViews - b.avgViews).slice(0, 5);
                window.lowAvgViewsChartInstance = new Chart(lowAvgViewsCtx, {
                    type: 'bar',
                    data: {
                        labels: sortedByAvgViewsAsc.map(p => formatClipLabel(p.name, 20)),
                        datasets: [{
                            label: 'Average Views per Clip',
                            data: sortedByAvgViewsAsc.map(p => p.avgViews),
                            backgroundColor: [clipPerformancePalette.redMid, clipPerformancePalette.orangeDark, clipPerformancePalette.yellowMid, clipPerformancePalette.yellowLight, clipPerformancePalette.blueLight], // A gradient from red to light blue
                            borderColor: 'rgba(255, 255, 255, 0.2)',
                            borderWidth: 1
                        }]
                    },
                    options: { ...clipSharedTooltipConfig,
                        indexAxis: 'y',
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: { ...clipSharedTooltipConfig.plugins,
                            legend: { display: false },
                            title: { display: true, text: 'Low 5 Profiles by Average Views per Clip', font: { size: 16 }, color: clipPerformancePalette.blueDark }
                        },
                        scales: {
                            x: { title: { display: true, text: 'Average Views per Clip' }, grid: { color: '#e5e7eb' } },
                            y: { grid: { display: false } }
                        }
                    }
                });
                showDebugMessage("Third Party July Charts initialized.");
            }

            // Function to populate the Low 5 Titles table
            function populateLowTitlesTable() {
                const tableBody = document.getElementById('lowTitlesTableBody');
                if (!tableBody) return;
                tableBody.innerHTML = ''; // Clear existing rows

                const low5Titles = [...thirdPartyJulyProfileData].sort((a, b) => a.avgViews - b.avgViews).slice(0, 5);

                // Create rows with loading indicators for reasons
                low5Titles.forEach(item => {
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td class="px-4 py-2 whitespace-nowrap">${item.name}</td>
                        <td class="px-4 py-2 whitespace-nowrap">${item.clips}</td>
                        <td class="px-4 py-2 whitespace-nowrap">${item.totalViews.toLocaleString()}</td>
                        <td class="px-4 py-2 whitespace-nowrap">${item.avgViews.toFixed(1)}</td>
                        <td class="px-4 py-2 text-slate-500 italic">No specific reason generated.</td>
                    `;
                    tableBody.appendChild(row);
                });
            }

            // Function to populate the new Top 10 Total Views table
            function populateTopTotalViewsTable() {
                const tableBody = document.getElementById('topTotalViewsTableBody');
                if (!tableBody) return;
                tableBody.innerHTML = ''; // Clear existing rows

                const top10TotalViews = [...thirdPartyJulyProfileData].sort((a, b) => b.totalViews - a.totalViews).slice(0, 10);

                top10TotalViews.forEach(item => {
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td class="px-4 py-2 whitespace-nowrap">${item.name}</td>
                        <td class="px-4 py-2 whitespace-nowrap">${item.clips}</td>
                        <td class="px-4 py-2 whitespace-nowrap">${item.totalViews.toLocaleString()}</td> <!-- Added Total Views -->
                        <td class="px-4 py-2 whitespace-nowrap">${item.avgViews.toFixed(1)}</td>
                    `;
                    tableBody.appendChild(row);
                });
            }

            // Event listener for the new "More Details" button for Top Total Views
            const showTopTotalViewsTableBtn = document.getElementById('showTopTotalViewsTableBtn');
            const topTotalViewsTableContainer = document.getElementById('topTotalViewsTableContainer');

            if (showTopTotalViewsTableBtn && topTotalViewsTableContainer) {
                showTopTotalViewsTableBtn.addEventListener('click', () => {
                    topTotalViewsTableContainer.classList.toggle('hidden');
                    showDebugMessage("Toggled Top Total Views Table visibility.");
                });
            }

            // Event listener for the new "More Details" button for Low Avg Views
            const showLowAvgViewsTableBtn = document.getElementById('showLowAvgViewsTableBtn');
            const lowTitlesTableContainer = document.getElementById('lowTitlesTableContainer');

            if (showLowAvgViewsTableBtn && lowTitlesTableContainer) {
                showLowAvgViewsTableBtn.addEventListener('click', () => {
                    lowTitlesTableContainer.classList.toggle('hidden');
                    showDebugMessage("Toggled Low Avg Views Table visibility.");
                });
            }

            // Modal functionality
            const shortsModal = document.getElementById('shortsModal');
            const closeModalBtn = document.getElementById('closeModalBtn');
            const modalTableBody = document.getElementById('modalTableBody');
            const modalTitle = document.getElementById('modalTitle');
            const debugMessageDiv = document.getElementById('debugMessage');

            function showDebugMessage(message) {
                debugMessageDiv.textContent = message;
                debugMessageDiv.classList.add('show');
                debugMessageDiv.classList.remove('hidden');
                setTimeout(() => {
                    debugMessageDiv.classList.remove('show');
                    debugMessageDiv.classList.add('hidden');
                }, 5000); // Message disappears after 5 seconds
            }

            function showShortsModal(title, data) {
                showDebugMessage(`Attempting to open ${title} shorts modal...`);
                modalTitle.textContent = `${title} Shorts Views`;
                modalTableBody.innerHTML = ''; // Clear previous data

                if (data && data.length > 0) {
                    data.forEach(item => {
                        const row = document.createElement('tr');
                        row.innerHTML = `
                            <td>${item.title}</td>
                            <td>${item.views.toLocaleString()}</td>
                        `;
                        modalTableBody.appendChild(row);
                    });
                } else {
                    const row = document.createElement('tr');
                    row.innerHTML = `<td colspan="2" class="text-center py-4 text-slate-500">No shorts data available for ${title}.</td>`;
                    modalTableBody.appendChild(row);
                }

                shortsModal.classList.add('show');
                showDebugMessage("Modal 'show' class added.");
            }

            closeModalBtn.addEventListener('click', () => {
                showDebugMessage("Close modal button clicked.");
                shortsModal.classList.remove('show');
                showDebugMessage("Modal 'show' class removed.");
            });

            // Close modal when clicking outside of it
            shortsModal.addEventListener('click', (event) => {
                if (event.target === shortsModal) {
                    showDebugMessage("Clicked outside modal, closing.");
                    shortsModal.classList.remove('show');
                }
            });

            // Initial updates
            updateKPIs(fullDailyData);
            populateTopTitlesTable(); // Populate the table on load
            showDebugMessage("Dashboard Initialized!"); // Confirm script execution
            // Do NOT call updateDailyViewsChart('all') here, as we want it hidden initially.
        });
    </script>
</body>
</html>
